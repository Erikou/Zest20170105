{% extends "SEInputBundle:Entry:input.html.twig" %}

{% macro entryCollection(entry) %}
  <tr>
    <td>#</td>
    <td>
        {{ form_widget(entry.employee, {'attr': {'class': 'form-control'}}) }}
        <p>SESA000000</p>
        {{ form_row(entry.presence.present) }}
        {{ form_widget(entry.presence.absenceReason, {'attr': {'class': 'form-control'}}) }}
    </td>
    <td>
      <div 
        id="activities-prototype"
        data-prototype="{{ _self.activityCollection(entry.activity_hours.vars.prototype) | e }}">
          {% for activity in entry.activity_hours %}
            {{ _self.activityCollection(activity) }}
          {% endfor %}
      </div>
    </td>
    <td>
      {{ form_widget(entry.comments, {'attr': {'class': 'form-control'}}) }}
      <br>
      <a href=# id="rmv" class="btn btn-danger" data-target="entries-prototype">
        <i class="glyphicon glyphicon-trash"></i>
      </a>
      <a href=# id="info" class="btn btn-info">
        <i class="glyphicon glyphicon-info-sign"></i>
      </a>
      <a href=# id="add" class="btn btn-success" data-target="activities-prototype">
        <i class="glyphicon glyphicon-plus"></i>
      </a>
    </td>
    {{ form_widget(entry) }}
  </tr>
{% endmacro %}

{% macro activityCollection(activity) %}
  <div>
    <div class="col-md-2">{{ form_widget(activity.activity, {'attr': {'class': 'form-control'}}) }} </div>
    <div class="col-md-5">
      <div>
        <div class="col-xs-3">
          {{ form_widget(activity.regularHours, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="col-xs-3">
          {{ form_widget(activity.otHours, {'attr': {'class': 'form-control'}}) }}
        </div>
        <div class="col-xs-3">
          <div class="input-group clockpicker" data-autoclose="true">
            {{ form_widget(activity.otStartTime, {'attr': {'class': 'form-control'}}) }}
            <span class="input-group-addon">
              <span class="glyphicon glyphicon-time"></span>
            </span>
          </div>
        </div>
        <div class="col-xs-3">
          <div class="input-group clockpicker" data-autoclose="true">
            {{ form_widget(activity.otEndTime, {'attr': {'class': 'form-control'}}) }}
            <span class="input-group-addon">
              <span class="glyphicon glyphicon-time"></span>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-2">
      {{ form_widget(activity.team, {'attr': {'class': 'form-control'}}) }}
      {{ form_widget(activity.shift, {'attr': {'class': 'form-control'}}) }}
    </div>
    <div class="col-md-2">
      {{ form_widget(activity.zone, {'attr': {'class': 'form-control'}}) }}
      {{ form_widget(activity.workstation, {'attr': {'class': 'form-control'}}) }}
    </div>
    <div class="col-md-1">
      <a href=# id="rmv" class="btn btn-danger" data-target="activities-prototype">
        <i class="glyphicon glyphicon-trash"></i>
      </a>
    </div>   
    {{ form_widget(activity) }}
  </div>
{% endmacro %}

 {% block seinput_form %}

  <div class="well">
   {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

    {{ form_errors(form) }}

     <div class="form-group">
        {{ form_label(form.user, "User", {'label_attr': {'class': 'col-sm-3 control-label'}}) }}
        {{ form_errors(form.user) }}
        <div class="col-sm-4">
          {{ form_widget(form.user, {'attr': {'class': 'form-control'}}) }}
        </div>
    </div>
    
    <div class="form-group">
     
     <div class="table-responsive">
        <table class="table table-hover table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>Employee</th>
              <th>
                <table>
                <thead>
                  <tr>
                      <th class="col-xs-2">Activity</th>
                      <th class="col-xs-5" >Hours</th>
                      <th class="col-xs-2">Transfer Out</th>
                      <th class="col-xs-2">Workstation</th>
                      <th class="col-xs-1">
                      </th>
                    </tr>
                </thead>
              </table>
              </th>
              <th>Comments</th>
            </tr>
          </thead>
          <tbody id="entries">
            <div 
            id="entries-prototype"
            data-prototype="{{ _self.entryCollection(form.input_entries.vars.prototype)|e }}">
              {% for entry in form.input_entries %}
                {{ _self.entryCollection(entry) }}
              {% endfor %}
            </div>
          </tbody>
        </table>
      </div>
      <p>
        <a href=# id="add" class="btn btn-success" data-target="entries-prototype">
          <i class="glyphicon glyphicon-plus"></i>
        </a>
      </p> 
    </div>
 
    <div class="form-group">
      {{ form_widget(form.save, {'attr': {'class': 'btn btn-success'}}) }}
    </div>
    
    {{ form_rest(form) }}
    {{ form_end(form) }}
  </div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
{% javascripts '@SEInputBundle/Resources/public/js/*' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
<script type="text/javascript">
  $('.clockpicker').clockpicker();
</script>

{% endblock %}